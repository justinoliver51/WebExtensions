package com.IBTrading.emailmonitor;

import java.util.Properties;

import javax.mail.Folder;
import javax.mail.Message;
import javax.mail.MessagingException;
import javax.mail.NoSuchProviderException;
import javax.mail.Session;
import javax.mail.Store;

import com.IBTrading.servlets.TradeCenter;

public class EmailMonitor 
{
	private static TradeCenter tradeCenter;
	private final String USERNAME = "justinoliver51@gmail.com";
	private final String PASSWORD = "smnSMN!0519";
	
	public EmailMonitor(TradeCenter newTradeCenter)
	{
		tradeCenter = newTradeCenter;
		//startMonitoringEmail();
	}
	
	public void startMonitoringEmail()
	{
		// FIXME: Probably needs to create a new thread!
		monitorEmail();
	}
	
	public void monitorEmail()
	{
		Properties props = System.getProperties();
		props.setProperty("mail.store.protocol", "imaps");
		try 
		{
			Session session = Session.getDefaultInstance(props, null);
			Store store = session.getStore("imaps");
			store.connect("imap.gmail.com", USERNAME, PASSWORD);
			System.out.println(store);

			Folder inbox = store.getFolder("Inbox");
			inbox.open(Folder.READ_ONLY);
			Message messages[] = inbox.getMessages();
			for(Message message:messages) 
			{
				System.out.println(message);
			}
			
			/* 
			FlagTerm ft = new FlagTerm(new Flags(Flags.Flag.SEEN), false);

			Message messages[] = inbox.search(ft);
			 
			 */
			
		} catch (NoSuchProviderException e) 
		{
			e.printStackTrace();
			System.exit(1);
		} catch (MessagingException e) 
		{
			e.printStackTrace();
			System.exit(2);
		}
	}
}
